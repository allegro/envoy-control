# Configuration

This is a global list of all the settings

## GRPC server
Property                                                                                    | Description                                                                                                                                                                               | Default value
------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.server.executorGroup.type**                                                 | Group executor type. DIRECT or PARALLEL                                                                                                                                                   | DIRECT
**envoy-control.server.executorGroup.parallelPoolSize**                                     | Pool size used for executor group in PARALLEL mode                                                                                                                                        | 4
**envoy-control.server.nioEventLoopThreadCount**                                            | The number of threads that will be used by netty's nio event loop                                                                                                                         | 1
**envoy-control.server.nioEventLoopPoolSize**                                               | Pool size of NIO Event Loop                                                                                                                                                               | 0 (Number of CPUs * 2)
**envoy-control.server.netty.keepAliveTime**                                                | Sets a custom keepalive time for Netty server                                                                                                                                             | 15s
**envoy-control.server.netty.permitKeepAliveTime**                                          | Specify the most aggressive keep-alive time clients are permitted to configure (in seconds)                                                                                               | 10s
**envoy-control.server.netty.permitKeepAliveWithoutCalls**                                  | Sets whether to allow clients to send keep-alive HTTP/2 PINGs even if there are no outstanding RPCs on the connection                                                                     | true
**envoy-control.server.port**                                                               | Port of the xDS server                                                                                                                                                                    | 50000
**envoy-control.server.serverPoolSize**                                                     | Pool size of xDS server                                                                                                                                                                   | 16
**envoy-control.server.serverPoolKeepAlive**                                                | Threads keep alive in xDS server pool                                                                                                                                                     | 10m
**envoy-control.server.snapshotCleanup.collectAfterMillis**                                 | How long a snapshot must be referenced before being collected                                                                                                                             | 10s
**envoy-control.server.snapshotCleanup.collectionIntervalMillis**                           | How often the collection background action should run                                                                                                                                     | 10s

## Snapshot properties
Property                                                                                               | Description                                                                                                                                                                               | Default value
-------------------------------------------------------------------------------------------------------| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.envoy.snapshot.edsConnectionTimeout**                                                  | Connection timeout for EDS clusters                                                                                                                                                       | 2s
**envoy-control.envoy.snapshot.egress.commonHttp.idleTimeout**                                         | Set idle timeout for all HTTP connections (HTTP/1 and HTTP/2)                                                                                                                             | 120s
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.highThreshold.maxConnections**        | The maximum number of connections that Envoy will make to the upstream cluster for high priority threshold.                                                                               | 1024
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.highThreshold.maxPendingRequests**    | The maximum number of pending requests that Envoy will allow to the upstream cluster for high priority threshold.                                                                         | 1024
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.highThreshold.maxRequests**           | The maximum number of parallel requests that Envoy will make to the upstream cluster for high priority threshold.                                                                         | 1024
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.highThreshold.maxRetries**            | The maximum number of parallel retries that Envoy will allow to the upstream cluster for high priority threshold.                                                                         | 3
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.defaultThreshold.maxConnections**     | The maximum number of connections that Envoy will make to the upstream cluster for default priority threshold.                                                                            | 1024
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.defaultThreshold.maxPendingRequests** | The maximum number of pending requests that Envoy will allow to the upstream cluster for default priority threshold.                                                                      | 1024
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.defaultThreshold.maxRequests**        | The maximum number of parallel requests that Envoy will make to the upstream cluster for default priority threshold.                                                                      | 1024
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.defaultThreshold.maxRetries**         | The maximum number of parallel retries that Envoy will allow to the upstream cluster for default priority threshold.                                                                      | 3
**envoy-control.envoy.snapshot.egress.clusterNotFoundStatusCode**                                      | Status code when cluster is not found                                                                                                                                                     | 503
**envoy-control.envoy.snapshot.egress.http2.enabled**                                                  | Enable http2 for clusters that use envoy                                                                                                                                                  | true
**envoy-control.envoy.snapshot.egress.http2.tagName**                                                  | Tag to be used to identify if instance uses envoy                                                                                                                                         | envoy
**envoy-control.envoy.snapshot.egress.handleInternalRedirect**                                         | Handle redirects by Envoy                                                                                                                                                                 | false
**envoy-control.envoy.snapshot.localService.idleTimeout**                                              | Idle timeout between client to envoy                                                                                                                                                      | 60s
**envoy-control.envoy.snapshot.localService.responseTimeout**                                          | Response timeout for localService                                                                                                                                                         | 15s
**envoy-control.envoy.snapshot.routes.initialVersion**                                                 | Set initial version for generated routes                                                                                                                                                  | "empty"
**envoy-control.envoy.snapshot.routes.metrics.enabled**                                                | Enable metrics route                                                                                                                                                                      | false
**envoy-control.envoy.snapshot.routes.metrics.pathPrefix**                                             | Path prefix of metrics                                                                                                                                                                    | /status/envoy/stats/prometheus
**envoy-control.envoy.snapshot.routes.status.metrics.enabled**                                         | Enable status route                                                                                                                                                                       | false
**envoy-control.envoy.snapshot.routes.status.metrics.pathPrefix**                                      | Path prefix of metrics                                                                                                                                                                    | /status
**envoy-control.envoy.snapshot.routes.status.metrics.createVirtualCluster**                            | Create virtual cluster for status route                                                                                                                                                   | false
**envoy-control.envoy.snapshot.stateSampleDuration**                                                   | Duration of state sampling (this is used to prevent surges in consul events overloading control plane)                                                                                    | 1s
**envoy-control.envoy.snapshot.xdsClusterName**                                                        | Name of cluster for xDS operations                                                                                                                                                        | envoy-control-xds

## Permissions
Property                                                                                    | Description                                                                                                                                                                               | Default value
------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.envoy.snapshot.incomingPermissions.enabled**                                | Enable incoming permissions                                                                                                                                                               | false
**envoy-control.envoy.snapshot.incomingPermissions.endpointUnavailableStatusCode**          | Status code when endpoint is not available                                                                                                                                                | 503
**envoy-control.envoy.snapshot.incomingPermissions.clientIdentityHeader**                   | Header that identifies the client that called the endpoint                                                                                                                                | x-service-name
**envoy-control.envoy.snapshot.outgoingPermissions.enabled**                                | Enable outgoing permissions                                                                                                                                                               | false
**envoy-control.envoy.snapshot.outgoingPermissions.allServicesDependenciesValue**           | Special value that signifies that the service depends on all other services                                                                                                               | *
**envoy-control.envoy.snapshot.outgoingPermissions.servicesAllowedToUseWildcard**           | Services that are allowed to have the special value in outgoing.dependency field                                                                                                          | false

## Outlier detection
Property                                                                                    | Description                                                                                                                                                                               | Default value
------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.envoy.snapshot.clusterOutlierDetection.enabled**                            | Enable cluster outlier detection                                                                                                                                                          | false
**envoy-control.envoy.snapshot.clusterOutlierDetection.baseEjectionTime**                   | The base time that a host is ejected for                                                                                                                                                  | 30s
**envoy-control.envoy.snapshot.clusterOutlierDetection.consecutiveGatewayFailure**          | The number of consecutive gateway failures (502, 503, 504 status or connection errors that are mapped to one of those status codes) before a consecutive gateway failure ejection occurs  | 5
**envoy-control.envoy.snapshot.clusterOutlierDetection.consecutive5xx**                     | The number of consecutive 5xx responses before a consecutive 5xx ejection                                                                                                                 | 5
**envoy-control.envoy.snapshot.clusterOutlierDetection.enforcingConsecutiveGatewayFailure** | The % chance that a host will be actually ejected when an outlier status is detected through consecutive gateway failures                                                                 | 0
**envoy-control.envoy.snapshot.clusterOutlierDetection.enforcingConsecutive5xx**            | The % chance that a host will be actually ejected when an outlier status is detected through consecutive 5xx                                                                              | 100
**envoy-control.envoy.snapshot.clusterOutlierDetection.enforcingSuccessRate**               | The % chance that a host will be actually ejected when an outlier status is detected through success rate statistics                                                                      | 100
**envoy-control.envoy.snapshot.clusterOutlierDetection.interval**                           | The time interval between ejection analysis sweeps                                                                                                                                        | 10s
**envoy-control.envoy.snapshot.clusterOutlierDetection.maxEjectionPercent**                 | The maximum % of an upstream cluster that can be ejected due to outlier detection                                                                                                         | 10
**envoy-control.envoy.snapshot.clusterOutlierDetection.successRateMinimumHosts**            | The number of hosts in a cluster that must have enough request volume to detect success rate outliers                                                                                     | 5
**envoy-control.envoy.snapshot.clusterOutlierDetection.successRateRequestVolume**           | The minimum number of total requests that must be collected in one interval (as defined by the interval duration above) to include this host * in success rate based outlier detection    | 100
**envoy-control.envoy.snapshot.clusterOutlierDetection.successRateStdevFactor**             | This factor is used to determine the ejection threshold for success rate outlier ejection.                                                                                                | 1900

## Retries
Property                                                                                            | Description                                                                                                                                                                               | Default value
----------------------------------------------------------------------------------------------------| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.envoy.snapshot.localService.retryPolicy.\<selector>.enabled**                       | Enable retry policy for localService                                                                                                                                                      | false
**envoy-control.envoy.snapshot.localService.retryPolicy.\<selector>.retryOn**                       | When should envoy retry request [Envoy V2 API retry-on](https://www.envoyproxy.io/docs/envoy/latest/configuration/http_filters/router_filter#x-envoy-retry-on)                            | empty list
**envoy-control.envoy.snapshot.localService.retryPolicy.\<selector>.numRetries**                    | Number of retries                                                                                                                                                                         | 1
**envoy-control.envoy.snapshot.localService.retryPolicy.\<selector>.perTryTimeout**                 | Specifies a non-zero upstream timeout per retry attempt                                                                                                                                   | 0ms
**envoy-control.envoy.snapshot.localService.retryPolicy.\<selector>.hostSelectionRetryMaxAttempts** | The maximum number of times host selection will be reattempted before request being routed to last selected host                                                                          | 1
**envoy-control.envoy.snapshot.localService.retryPolicy.\<selector>.retriableStatusCodes**          | HTTP status codes for which envoy should trigger retry in addition to retryOn                                                                                                             | empty list

Where `<selector>` is one of the following:
* `perHttpMethod.{GET,HEAD,POST,PUT,DELETE}` - retry policy for requests with given HTTP method
* `default` - default retry policy, applied for every request that doesn't match more specific selector

## Cross DC synchronization
Property                                                                                    | Description                                                                                                                                                                               | Default value
------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.sync.enabled**                                                              | Enable Cross DC Synchronization                                                                                                                                                           | false
**envoy-control.sync.connectionTimeout**                                                    | Connection timeout to other Envoy Controls                                                                                                                                                | 1s
**envoy-control.sync.envoyControlAppName**                                                  | Envoy Control app name available in discovery service                                                                                                                                     | envoy-control
**envoy-control.sync.pollingInterval**                                                      | Polling interval in seconds                                                                                                                                                               | 1
**envoy-control.sync.readTimeout**                                                          | Read timeout to other Envoy Controls                                                                                                                                                      | 500ms

## Service filters
Property                                                                                    | Description                                                                                                                                                                               | Default value
------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.serviceFilters.excludedNamesPatterns**                                      | Regex for excluding services with a given name                                                                                                                                            | empty list

## Consul
Property                                                                                    | Description                                                                                                                                                                               | Default value
------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.source.consul.host**                                                        | Hostname of consul server                                                                                                                                                                 | localhost
**envoy-control.source.consul.port**                                                        | Port of consul server                                                                                                                                                                     | 8500
