# Configuration

This is a global list of all the settings

## GRPC server
Property                                                                                    | Description                                                                                                                                                                               | Default value
------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.server.executor-group.type**                                                | Group executor type. DIRECT or PARALLEL                                                                                                                                                   | DIRECT
**envoy-control.server.executor-group.parallel-pool-size**                                  | Pool size used for executor group in PARALLEL mode                                                                                                                                        | 4
**envoy-control.server.nio-event-loop-thread-count**                                        | The number of threads that will be used by netty's nio event loop                                                                                                                         | 1
**envoy-control.server.nio-event-loop-pool-size**                                           | Pool size of NIO Event Loop                                                                                                                                                               | 0 (Number of CPUs * 2)
**envoy-control.server.netty.keep-alive-time**                                              | Sets a custom keepalive time for Netty server                                                                                                                                             | 15s
**envoy-control.server.netty.permit-keep-alive-time**                                       | Specify the most aggressive keep-alive time clients are permitted to configure (in seconds)                                                                                               | 10s
**envoy-control.server.netty.permit-keep-alive-without-calls**                              | Sets whether to allow clients to send keep-alive HTTP/2 PINGs even if there are no outstanding RPCs on the connection                                                                     | true
**envoy-control.server.port**                                                               | Port of the xDS server                                                                                                                                                                    | 50000
**envoy-control.server.server-pool-size**                                                   | Pool size of xDS server                                                                                                                                                                   | 16
**envoy-control.server.server-poolkeep-alive**                                              | Threads keep alive in xDS server pool                                                                                                                                                     | 10m
**envoy-control.server.group-snapshot-update-scheduler.type**                               | Scheduler type for update snapshot for groups operation. DIRECT or PARALLEL                                                                                                               | DIRECT
**envoy-control.server.group-snapshot-update-scheduler.parallel-pool-size**                 | Parallelism level for PARALLEL mode. Should match executor pool size if custom executor is used                                                                                           | 1
**envoy-control.server.snapshot-cleanup.collect-after-millis**                              | How long a snapshot must be referenced before being collected                                                                                                                             | 10s
**envoy-control.server.snapshot-cleanup.collection-interval-millis**                        | How often the collection background action should run                                                                                                                                     | 10s

## Snapshot properties
Property                                                                                               | Description                                                                                                                                                                                                 | Default value
-------------------------------------------------------------------------------------------------------| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.envoy.snapshot.dynamicListeners.enabled**                                              | Enable or disable creating listeners using dynamic configuration                                                                                                                                            | true
**envoy-control.envoy.snapshot.dynamicListeners.httpFilters.accessLog.timeFormat**                     | Time format for access logs                                                                                                                                                                                 | "%START_TIME(%FT%T.%3fZ)%"
**envoy-control.envoy.snapshot.dynamicListeners.httpFilters.accessLog.messageFormat**                  | Message format for access logs                                                                                                                                                                              | "%PROTOCOL% %REQ(:METHOD)% %REQ(:authority)% %REQ(:PATH)% %DOWNSTREAM_REMOTE_ADDRESS% -> %UPSTREAM_HOST%"
**envoy-control.envoy.snapshot.dynamicListeners.httpFilters.accessLog.level**                          | Logging level for access logs                                                                                                                                                                               | "TRACE"
**envoy-control.envoy.snapshot.dynamicListeners.httpFilters.accessLog.logger**                         | Logger name for access logs                                                                                                                                                                                 | "envoy.AccessLog"
**envoy-control.envoy.snapshot.dynamicListeners.httpFilters.ingressXffNumTrustedHops**                 | Number of trusted hops for ingress filter (refer to [envoy docs](https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_conn_man/headers.html?highlight=xff_num_trusted_hops#x-forwarded-for)) | 1
**envoy-control.envoy.snapshot.edsConnectionTimeout**                                                  | Connection timeout for EDS clusters                                                                                                                                                                         | 2s
**envoy-control.envoy.snapshot.egress.commonHttp.idleTimeout**                                         | Set idle timeout for all HTTP connections (HTTP/1 and HTTP/2)                                                                                                                                               | 120s
**envoy-control.envoy.snapshot.egress.commonHttp.requestTimeout**                                      | Set request timeout for all routes (HTTP/1 and HTTP/2)                                                                                                                                                      | 120s
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.highThreshold.maxConnections**        | The maximum number of connections that Envoy will make to the upstream cluster for high priority threshold.                                                                                                 | 1024
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.highThreshold.maxPendingRequests**    | The maximum number of pending requests that Envoy will allow to the upstream cluster for high priority threshold.                                                                                           | 1024
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.highThreshold.maxRequests**           | The maximum number of parallel requests that Envoy will make to the upstream cluster for high priority threshold.                                                                                           | 1024
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.highThreshold.maxRetries**            | The maximum number of parallel retries that Envoy will allow to the upstream cluster for high priority threshold.                                                                                           | 3
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.defaultThreshold.maxConnections**     | The maximum number of connections that Envoy will make to the upstream cluster for default priority threshold.                                                                                              | 1024
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.defaultThreshold.maxPendingRequests** | The maximum number of pending requests that Envoy will allow to the upstream cluster for default priority threshold.                                                                                        | 1024
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.defaultThreshold.maxRequests**        | The maximum number of parallel requests that Envoy will make to the upstream cluster for default priority threshold.                                                                                        | 1024
**envoy-control.envoy.snapshot.egress.commonHttp.circuitBreakers.defaultThreshold.maxRetries**         | The maximum number of parallel retries that Envoy will allow to the upstream cluster for default priority threshold.                                                                                        | 3
**envoy-control.envoy.snapshot.egress.neverRemoveClusters**                                            | Don't remove cluster, when corresponding service disappears from services source. Only remove all instances.                                                                                                | true
**envoy-control.envoy.snapshot.egress.clusterNotFoundStatusCode**                                      | Status code when cluster is not found                                                                                                                                                                       | 503
**envoy-control.envoy.snapshot.egress.http2.enabled**                                                  | Enable http2 for clusters that use envoy                                                                                                                                                                    | true
**envoy-control.envoy.snapshot.egress.http2.tagName**                                                  | Tag to be used to identify if instance uses envoy                                                                                                                                                           | envoy
**envoy-control.envoy.snapshot.egress.handleInternalRedirect**                                         | Handle redirects by Envoy                                                                                                                                                                                   | false
**envoy-control.envoy.snapshot.egress.hostHeaderRewriting.enabled**                                    | Enable rewriting Host header with value from specified header                                                                                                                                               | false
**envoy-control.envoy.snapshot.egress.hostHeaderRewriting.customHostHeader**                           | Header name which value will override Host header                                                                                                                                                           | "x-envoy-original-host"
**envoy-control.envoy.snapshot.ingress.headersToRemove**                                               | List of headers to sanitize                                                                                                                                                                                 | empty list
**envoy-control.envoy.snapshot.localService.idleTimeout**                                              | Idle timeout between client to envoy                                                                                                                                                                        | 60s
**envoy-control.envoy.snapshot.localService.responseTimeout**                                          | Response timeout for localService                                                                                                                                                                           | 15s
**envoy-control.envoy.snapshot.localService.connectionIdleTimeout**                                    | Connection idle timeout for localService                                                                                                                                                                    | 120s
**envoy-control.envoy.snapshot.routes.status.enabled**                                                 | Enable status route                                                                                                                                                                                         | false
**envoy-control.envoy.snapshot.routes.status.endpoints**                                               | List of endpoints with path or prefix of status routes                                                                                                                                                      | /status
**envoy-control.envoy.snapshot.routes.status.create-virtual-cluster**                                  | Create virtual cluster for status route                                                                                                                                                                     | false
**envoy-control.envoy.snapshot.stateSampleDuration**                                                   | Duration of state sampling (this is used to prevent surges in consul events overloading control plane)                                                                                                      | 1s
**envoy-control.envoy.snapshot.xdsClusterName**                                                        | Name of cluster for xDS operations                                                                                                                                                                          | envoy-control-xds
**envoy-control.envoy.snapshot.enabledCommunicationModes.ads**                                         | Enable or disable support for ADS communication mode                                                                                                                                                        | true
**envoy-control.envoy.snapshot.enabledCommunicationModes.xds**                                         | Enable or disable support for XDS communication mode                                                                                                                                                        | true
**envoy-control.envoy.snapshot.shouldSendMissingEndpoints**                                            | Enable sending missing Endpoints - when Envoy requests for not existing cluster in snapshot control-plane will respond with empty Endpoint definition                                                       | false
     
## Permissions
Property                                                                                                                                           | Description                                                                                                                                                                                                      | Default value
-------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.envoy.snapshot.incoming-permissions.enabled**                                                                                      | Enable incoming permissions                                                                                                                                                                                      | false
**envoy-control.envoy.snapshot.incoming-permissions.client-identity-headers**                                                                      | Headers that identify the client that called the endpoint. In most cases `client-identity-header` should include `service-name-header` value to correctly identify other services in the mesh.                   | [ x-service-name ]
**envoy-control.envoy.snapshot.incoming-permissions.service-name-header**                                                                          | Name of a header to propagate a called endpoint's service name upstream                                                                                                                                          | x-service-name
**envoy-control.envoy.snapshot.incoming-permissions.source-ip-authentication.ip-from-service-discovery.enabled-for-incoming-services**             | Enable source ip based authentication for selected services                                                                                                                                                      | empty list
**envoy-control.envoy.snapshot.incoming-permissions.source-ip-authentication.ip-from-range**                                                       | Enable source ip based authentication for selected clients using static IP ranges                                                                                                                                | empty map
**envoy-control.envoy.snapshot.incoming-permissions.source-ip-authentication.ip-from-range.{name}**                                                | User chosen name for static ip range, it must match client name defined in incoming permissions                                                                                                                  | none
**envoy-control.envoy.snapshot.incoming-permissions.source-ip-authentication.ip-from-range.{name}.{ip}/{prefix}**                                  | Ip and prefix informat of {ip}/{prefix} for static ip range. Eg: 192.168.1.0/24                                                                                                                                  | empty string
**envoy-control.envoy.snapshot.incoming-permissions.selector-matching.{name}.**                                                                    | Selector matching is used to further authenticate source IP targets. {name} corresponds to client name defined in incoming permissions and IP range                                                              | empty map
**envoy-control.envoy.snapshot.incoming-permissions.selector-matching.{name}.header.{selector-name}**                                              | Name used to identify the selector. For `header` authentication it is the header name. In the future for metadata it will be filter/path.                                                                        | empty string
**envoy-control.envoy.snapshot.incoming-permissions.tls-authentication.tls-context-metadata-match-key**                                            | Name of tls context metadata matcher key                                                                                                                                                                         | acceptMTLS
**envoy-control.envoy.snapshot.incoming-permissions.tls-authentication.validation-context-secret-name**                                            | Name of validation context config, has to match static configuration in Envoy config                                                                                                                             | validation_context
**envoy-control.envoy.snapshot.incoming-permissions.tls-authentication.tls-certificate-secret-name**                                               | Name of server TLS Certificate config, has to match static configuration in Envoy config                                                                                                                         | server_cert
**envoy-control.envoy.snapshot.incoming-permissions.tls-authentication.require-client-certificate**                                                | Enable to reject TLS connections without a client certificate. Even if set to false, incoming permissions are still enforced.                                                                                    | false
**envoy-control.envoy.snapshot.incoming-permissions.tls-authentication.protocol.minimum-version**                                                  | Minimum version of TLS protocol used                                                                                                                                                                             | "TLSv1_2"
**envoy-control.envoy.snapshot.incoming-permissions.tls-authentication.protocol.maximum-version**                                                  | Maximum version of TLS protocol used                                                                                                                                                                             | "TLSv1_2"
**envoy-control.envoy.snapshot.incoming-permissions.tls-authentication.protocol.cipher-suites**                                                    | A list of cipher suites to use                                                                                                                                                                                   | list of "ECDHE-ECDSA-AES128-GCM-SHA256", "ECDHE-RSA-AES128-GCM-SHA256"
**envoy-control.envoy.snapshot.incoming-permissions.tls-authentication.mtls-enabled-tag**                                                          | Name of tag that is used to identify if mTLS should be enabled for cluster (note that `envoy-control.envoy.snapshot.egress.http2.enabled` should also be enabled)                                                | mtls:enabled
**envoy-control.envoy.snapshot.incoming-permissions.tls-authentication.san-uri-format**                                                            | URI format for SAN field that will be matched in client/server validation. {service-name} will be replaced by service name from discovery source.                                                                | spiffe://{service-name}
**envoy-control.envoy.snapshot.incoming-permissions.tls-authentication.service-name-wildcard-regex**                                               | Regex to match service-names for "wildcard" client identifier. By default it will match all service names of length greater than zero (.+). It is used in place of {service-name} placeholder in san-uri-format. | .+
**envoy-control.envoy.snapshot.outgoing-permissions.tls-authentication.services-allowed-to-use-wildcard**                                          | Services that are allowed to have wildcard in incoming.clients field                                                                                                                                             | empty set
**envoy-control.envoy.snapshot.outgoing-permissions.tls-authentication.wildcard-client-identifier**                                                | Special value (wildcard) that signifies that the service accepts traffic from all other validated services                                                                                                       | *
**envoy-control.envoy.snapshot.outgoing-permissions.enabled**                                                                                      | Enable outgoing permissions                                                                                                                                                                                      | false
**envoy-control.envoy.snapshot.outgoing-permissions.all-services-dependencies.identifier**                                                         | Special value (wildcard) that signifies that the service depends on all other services                                                                                                                           | *
**envoy-control.envoy.snapshot.outgoing-permissions.all-services-dependencies.not-included-by-prefix**                                             | Services not included in dependencies for services with wildcard in outgoing.dependency field. Matched by service name prefix.                                                                                   | empty list
**envoy-control.envoy.snapshot.outgoing-permissions.services-allowed-to-use-wildcard**                                                             | Services that are allowed to have wildcard in outgoing.dependency field                                                                                                                                          | empty set

## Load Balancing
Property                                                                                    | Description                                                                                                                                                                               | Default value
------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.envoy.snapshot.load-balancing.weights.enabled**                             | if set to true, weighted load balancing will be enabled                                                                                                                                   | false
**envoy-control.envoy.snapshot.load-balancing.canary.enabled**                              | if set to true, routing to canary instances based on *canary header* will be enabled (corresponding Envoy static config is required, see [docs](../features/load_balancing))              | false
**envoy-control.envoy.snapshot.load-balancing.canary.metadata-key**                         | metadata that will be set for canary EDS endpoints - key (must match Envoy static `header_to_metadata` filter config, see [docs](../features/load_balancing))                             | canary
**envoy-control.envoy.snapshot.load-balancing.canary.header-value**                         | only when *canary header* is set to this value request will be routed to canary instances (*canary header* name is set in Envoy static config, see [docs](../features/load_balancing))    | 1
**envoy-control.envoy.snapshot.load-balancing.policy**                                      | load balancing policy used for clusters. [Accepted values](https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cds.proto.html#enum-cluster-lbpolicy)                                | LEAST_REQUEST
**envoy-control.envoy.snapshot.load-balancing.use-keys-subset-fallback-policy**             | KEYS_SUBSET fallback policy is used by default when canary and service-tags are enabled. It is not supported in Envoy <= 1.12.x. Set to false for compatibility with Envoy 1.12.x         | true

## Routing
Property                                                                                    | Description                                                                                                                                                                               | Default value
------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.envoy.snapshot.routing.service-tags.enabled**                               | If set to true, service tags routing will be enabled                                                                                                                                      | false
**envoy-control.envoy.snapshot.routing.service-tags.metadata-key**                          | What key to use in endpoint metadata to store its service tags                                                                                                                            | tag
**envoy-control.envoy.snapshot.routing.service-tags.header**                                | What header to use in service tag rules                                                                                                                                                   | x-service-tag
**envoy-control.envoy.snapshot.routing.service-tags.routing-excluded-tags**                 | List of tags, that cannot be used for routing. Tags matching these patterns will be not saved in endpoint metadata                                                                        | empty list
**envoy-control.envoy.snapshot.routing.service-tags.allowed-tags-combinations**             | List of rules, which tags can be conbined together and requested together. Details below                                                                                                  | empty list
**(...).allowed-tags-combinations[].service-name**                                          | The rule will apply only for this service                                                                                                                                                 | ""
**(...).allowed-tags-combinations[].tags**                                                  | List of tag patterns, that can be combined and requested together                                                                                                                         | empty list

## Outlier detection
Property                                                                                      | Description                                                                                                                                                                               | Default value
--------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.envoy.snapshot.cluster-outlier-detection.enabled**                            | Enable cluster outlier detection                                                                                                                                                          | false
**envoy-control.envoy.snapshot.cluster-outlier-detection.baseEjectionTime**                   | The base time that a host is ejected for                                                                                                                                                  | 30s
**envoy-control.envoy.snapshot.cluster-outlier-detection.consecutiveGatewayFailure**          | The number of consecutive gateway failures (502, 503, 504 status or connection errors that are mapped to one of those status codes) before a consecutive gateway failure ejection occurs  | 5
**envoy-control.envoy.snapshot.cluster-outlier-detection.consecutive5xx**                     | The number of consecutive 5xx responses before a consecutive 5xx ejection                                                                                                                 | 5
**envoy-control.envoy.snapshot.cluster-outlier-detection.enforcingConsecutiveGatewayFailure** | The % chance that a host will be actually ejected when an outlier status is detected through consecutive gateway failures                                                                 | 0
**envoy-control.envoy.snapshot.cluster-outlier-detection.enforcingConsecutive5xx**            | The % chance that a host will be actually ejected when an outlier status is detected through consecutive 5xx                                                                              | 100
**envoy-control.envoy.snapshot.cluster-outlier-detection.enforcingSuccessRate**               | The % chance that a host will be actually ejected when an outlier status is detected through success rate statistics                                                                      | 100
**envoy-control.envoy.snapshot.cluster-outlier-detection.interval**                           | The time interval between ejection analysis sweeps                                                                                                                                        | 10s
**envoy-control.envoy.snapshot.cluster-outlier-detection.maxEjectionPercent**                 | The maximum % of an upstream cluster that can be ejected due to outlier detection                                                                                                         | 10
**envoy-control.envoy.snapshot.cluster-outlier-detection.successRateMinimumHosts**            | The number of hosts in a cluster that must have enough request volume to detect success rate outliers                                                                                     | 5
**envoy-control.envoy.snapshot.cluster-outlier-detection.successRateRequestVolume**           | The minimum number of total requests that must be collected in one interval (as defined by the interval duration above) to include this host * in success rate based outlier detection    | 100
**envoy-control.envoy.snapshot.cluster-outlier-detection.successRateStdevFactor**             | This factor is used to determine the ejection threshold for success rate outlier ejection.                                                                                                | 1900

## Retries
Property                                                                                            | Description                                                                                                                                                                               | Default value
----------------------------------------------------------------------------------------------------| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.envoy.snapshot.localService.retryPolicy.\<selector>.enabled**                       | Enable retry policy for localService                                                                                                                                                      | false
**envoy-control.envoy.snapshot.localService.retryPolicy.\<selector>.retryOn**                       | When should envoy retry request [Envoy V2 API retry-on](https://www.envoyproxy.io/docs/envoy/latest/configuration/http_filters/router_filter#x-envoy-retry-on)                            | empty list
**envoy-control.envoy.snapshot.localService.retryPolicy.\<selector>.numRetries**                    | Number of retries                                                                                                                                                                         | 1
**envoy-control.envoy.snapshot.localService.retryPolicy.\<selector>.perTryTimeout**                 | Specifies a non-zero upstream timeout per retry attempt                                                                                                                                   | 0ms
**envoy-control.envoy.snapshot.localService.retryPolicy.\<selector>.hostSelectionRetryMaxAttempts** | The maximum number of times host selection will be reattempted before request being routed to last selected host                                                                          | 1
**envoy-control.envoy.snapshot.localService.retryPolicy.\<selector>.retriableStatusCodes**          | HTTP status codes for which envoy should trigger retry in addition to retryOn                                                                                                             | empty list

Where `<selector>` is one of the following:
* `perHttpMethod.{GET,HEAD,POST,PUT,DELETE}` - retry policy for requests with given HTTP method
* `default` - default retry policy, applied for every request that doesn't match more specific selector

## Metrics
Property                                                                                    | Description                                                                                                                                                                               | Default value
--------------------------------------------------------------------------------------------| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.envoy.snapshot.metrics.cache-set-snapshot**                                 | Report metrics for cache.setSnapshot operation                                                                                                                                            | false

## Cross DC synchronization
Property                                                                                    | Description                                                                                                                                                                               | Default value
------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.sync.enabled**                                                              | Enable Cross DC Synchronization                                                                                                                                                           | false
**envoy-control.sync.connectionTimeout**                                                    | Connection timeout to other Envoy Controls                                                                                                                                                | 1s
**envoy-control.sync.envoyControlAppName**                                                  | Envoy Control app name available in discovery service                                                                                                                                     | envoy-control
**envoy-control.sync.pollingInterval**                                                      | Polling interval in seconds                                                                                                                                                               | 1
**envoy-control.sync.readTimeout**                                                          | Read timeout to other Envoy Controls                                                                                                                                                      | 500ms

## Service filters
Property                                                                                    | Description                                                                                                                                                                               | Default value
------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.serviceFilters.excludedNamesPatterns**                                      | Regex for excluding services with a given name                                                                                                                                            | empty list

## Consul
Property                                                                                    | Description                                                                                                                                                                               | Default value
------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------
**envoy-control.source.consul.host**                                                        | Hostname of consul server                                                                                                                                                                 | localhost
**envoy-control.source.consul.port**                                                        | Port of consul server                                                                                                                                                                     | 8500
**envoy-control.source.consul.tags.weight**                                                 | Service instance tag which will be mapped to instance weight. If set to `<name>`, expected tag will be `<name>:<value>`, where `<value>` is an integer (>0) representing instance weight  | weight
**envoy-control.source.consul.tags.default-weight**                                         | Default service instance weight, if weight tag is not present on the instance                                                                                                             | 50
**envoy-control.source.consul.tags.canary**                                                 | Service instance tag which indicate canary instance                                                                                                                                       | canary
